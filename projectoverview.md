lan# Dokumen Konsep Website

**Dokumen Konsep Website Program Penyaluran & Pelatihan Tenaga Kerja Jawa Barat**

1. **Pendahuluan**

Program ini merupakan inisiatif untuk mendukung peningkatan kualitas dan penyaluran tenaga kerja di Jawa Barat melalui platform digital yang modern, terukur, dan berorientasi pada kolaborasi berbentuk website. Website ini dirancang tidak hanya sebagai media informasi, tetapi juga sebagai **gerbang digital ekosistem ketenagakerjaan**, menghubungkan masyarakat, lembaga pelatihan, dan mitra industri dalam satu sistem yang terintegrasi.

2. **Latar Belakang**

Jawa Barat memiliki potensi sumber daya manusia yang besar, namun masih menghadapi tantangan dalam:

- Distribusi dan penyerapan tenaga kerja.

- Akses terhadap pelatihan kerja yang adaptif.

- Kolaborasi antara BLK, LPK, dan dunia industri.

Untuk menjawab tantangan tersebut, diperlukan platform digital yang mampu:

- Menyediakan informasi terpusat mengenai program pelatihan dan lowongan kerja.

- Memfasilitasi kemitraan antar lembaga.

- Memperkuat sistem monitoring dan pelaporan hasil program.

3. **Tujuan Pengembangan Website**

Website ini akan menjadi _hub_ utama dalam mendukung program peningkatan penyaluran tenaga kerja di Jawa Barat dengan tujuan:

1. Meningkatkan akses masyarakat terhadap informasi lowongan dan pelatihan kerja.

2. Memperkuat kolaborasi antar lembaga (LPK, BLK, dan mitra industri).

3. Meningkatkan transparansi data dan efektivitas program pelatihan kerja.

4. Menyediakan sistem pengelolaan digital bagi admin, lembaga, dan mitra dalam melakukan input, publikasi, serta monitoring kegiatan.

5. **Solusi Digital yang Diajukan**

- **Landing Page (Publik) :** Sebagai halaman utama yang berfungsi memperkenalkan program, menampilkan informasi umum, dan menjadi pintu masuk bagi calon peserta, lembaga, serta mitra.

- **Portal Sistem Pengelolaan (Internal) :** Sebagai sistem berbasis web yang memungkinkan admin, lembaga, dan mitra mengelola data lowongan kerja, program pelatihan, serta pelaporan kegiatan.

Pada tahap pertama, fokus pengembangan difokuskan pada **Landing Page** sebagai pondasi komunikasi publik dan branding digital program.

5. **Rencana Pengembangan Sistem**

- Menjadi _official site_ yang merepresentasikan semangat peningkatan tenaga kerja Jawa Barat.

- Menyajikan informasi dengan desain modern dan profesional.

- Membangun kepercayaan publik melalui transparansi, cerita sukses, dan kolaborasi nyata.

6. **Konsep Sistem Informasi Pengelolaan Penyaluran Tenaga Kerja**

Sistem informasi ini dirancang sebagai portal terintegrasi yang membantu pengelolaan data pelatihan, lowongan kerja, dan artikel secara digital oleh admin, lembaga pelatihan (LPK/BLK), serta pengguna umum.  
Tujuannya adalah menciptakan satu pusat data yang terukur dan mudah diakses untuk seluruh aktivitas penyaluran tenaga kerja di Jawa Barat.

---

### ðŸ”§ Struktur Sistem Secara Umum

1. **Portal Admin**  
    Admin dapat:

   - Mengelola data pelatihan dan lowongan kerja.

   - Menerbitkan artikel dan berita program.

   - Menyetujui pendaftaran lembaga pelatihan.

   - Memantau data peserta pelatihan, pendaftar lowongan, dan statistik sistem.

2. **Portal Lembaga (LPK/BLK)**  
    Lembaga pelatihan dapat:

   - Menginput dan memperbarui informasi program pelatihan mereka.

   - Melihat pendaftar dan status peserta.

   - Mengunggah dokumentasi kegiatan dan sertifikat pelatihan.

3. **Portal Pengguna (Peserta / Pencari Kerja)**  
    Masyarakat dapat:

   - Melihat dan mendaftar pelatihan yang tersedia.

   - Melihat lowongan kerja (eksternal) yang terverifikasi.

   - Membaca artikel dan berita program.

   - Melengkapi profil diri (CV digital sederhana).

---

### **Fitur Utama Sistem Informasi**

| Fitur                                     | Deskripsi Singkat                                                                                                   |
| ----------------------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| Manajemen Pengguna & Role                 | Terdiri dari tiga peran utama: Admin, Lembaga, dan Peserta. Masing-masing memiliki hak akses dan dashboard berbeda. |
| Manajemen Pelatihan (Training Management) | BLK/LPK bisa membuat dan mengelola program pelatihan, jadwal, kuota, serta status pendaftaran peserta.              |
| Manajemen Lowongan Kerja                  | Admin dapat menambahkan dan mengatur daftar lowongan kerja eksternal (link redirect ke sumber asli).                |
| Manajemen Artikel & Berita                | Admin dapat menulis, mempublikasi, dan mengarsipkan artikel kegiatan atau pengumuman program.                       |
| Sistem Approval                           | Admin menyetujui lembaga baru atau konten yang diajukan sebelum tampil publik.                                      |
| Dashboard KPI Dasar                       | Menampilkan statistik jumlah pelatihan, peserta, lembaga, dan lowongan aktif sebagai indikator capaian program.     |

### **Alur Pengguna Secara Umum**

1. Calon peserta / lembaga mengunjungi website dan menekan tombol â€œBergabungâ€ dari landing page.

2. Sistem menampilkan pilihan role:

   - _Lulusan / Mahasiswa (Peserta)_

   - _Lembaga Pelatihan (LPK/BLK)_

   - _Perusahaan (Employer â€“ untuk fase berikutnya)_

3. Setelah registrasi:

   - Peserta diarahkan untuk melengkapi data diri & membuat CV digital.

   - Lembaga diarahkan untuk mengisi profil lembaga dan menunggu verifikasi admin.

4. Setelah login, setiap role memiliki dashboard masing-masing sesuai hak akses.

5. Admin dapat melihat seluruh aktivitas (pendaftaran pelatihan, lembaga, artikel, dan lowongan) melalui dashboard KPI.

---

### ðŸŽ¯ Nilai Tambah Sistem Informasi

- Semua data pelatihan dan lowongan terkonsolidasi dalam satu platform digital.
- Meningkatkan efisiensi administrasi dan kolaborasi antar lembaga.
- Transparansi dan akuntabilitas dalam penyaluran tenaga kerja.
- Siap dikembangkan lebih lanjut menjadi ekosistem digital ketenagakerjaan berbasis data Jawa Barat.  


7. **Gaya Desain & Visual**

- **Warna Utama :** Oranye (\#F47B20), Putih (\#FFFFFF), Hitam (\#1E1E1E).

- **Gaya Visual :** Modern, bersih, profesional, dengan nuansa hangat dan semangat kolaborasi.

- **Teta Letak :** Full-width section, rounded corners, icon minimalis, animasi halus saat scroll.

- **Typography :** Sans-serif modern seperti Poppins / Inter / Manrope.

- **Ilutasi & Photo :** Gambar tenaga kerja muda, pelatihan digital, dan kegiatan BLK.

8. **Output & Deliverables**

- Website Landing Page responsif (desktop & mobile).

- Konten copywriting lengkap dalam bahasa Indonesia.

- Desain visual sesuai identitas program (warna oranye, putih, hitam).

- Akses admin dasar (untuk pengelolaan konten berita, lowongan, dan update program).

- Dokumentasi aset (logo, font, warna, dan komponen UI).

- Panduan penggunaan singkat (user guide).

9. **Penutup**

Website ini diharapkan menjadi simbol nyata dari upaya peningkatan kualitas tenaga kerja di Jawa Barat dan menghadirkan kemudahan akses informasi, memperkuat kolaborasi antar lembaga, dan menumbuhkan kepercayaan masyarakat melalui inovasi digital yang berdampak.

# RAB

## **Rencana Anggaran Biaya (RAB) Pengembangan Website Program Penyaluran & Pelatihan Tenaga Kerja Jawa Barat**

**Total Estimasi: Rp 18.800.000 (termasuk domain, hosting, dan maintenance awal)**

1. ### **DESAIN & USER EXPERIENCE**

|         No          | Uraian                        | Rincian Kegiatan                                                                                                    | Estimasi Biaya (Rp) |
| :-----------------: | ----------------------------- | ------------------------------------------------------------------------------------------------------------------- | ------------------- |
|          1          | Desain UI/UX Website          | Desain halaman landing page utama (desktop & mobile), wireframe, dan layout visual modern sesuai identitas program. | 2.500.000           |
|          2          | Komponen Visual & Style Guide | Pembuatan icon, banner, warna, dan sistem tipografi agar konsisten di semua halaman.                                | 1.500.000           |
| **Subtotal Desain** |                               |                                                                                                                     | **4.000.000**       |

2. ### **DEVELOPMENT WEBSITE**

|            No            | Uraian                         | Rincian Kegiatan                                                                                        | Estimasi Biaya (Rp) |
| :----------------------: | ------------------------------ | ------------------------------------------------------------------------------------------------------- | ------------------- |
|            1             | Frontend Development           | Pembuatan landing page interaktif berbasis **React \+ Vite \+ Tailwind \+ Shadcn UI \+ Framer Motion**. | 4.500.000           |
|            2             | Backend / CMS Ringan           | CRUD konten berita, program pelatihan, dan lowongan kerja via **Supabase / Node.js**                    | 2.500.000           |
|            3             | Interaktivitas & Responsivitas | Carousel event, gallery modal, counter animasi, optimasi SEO dan mobile.                                | 1.000.000           |
| **Subtotal Development** |                                |                                                                                                         | **8.000.000**       |

3. ### **INFRASTRUKTUR & DEPLOYMENT**

|                    No                    | Uraian                                     | Rincian Kegiatan                                                                                                                                                                                                                                                                 | Estimasi Biaya (Rp) |
| :--------------------------------------: | ------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------- |
|                    1                     | Domain Resmi (.id / .org, 1 Tahun)         | Domain kredibel untuk lembaga/instansi resmi.                                                                                                                                                                                                                                    | 800.000             |
|                    2                     | Cloud Hosting & Database Premium (1 Tahun) | Hosting menggunakan **VPS Premium \+ Supabase** dengan keunggulan: â€¢ Auto-scale saat traffic tinggi â€¢ CI/CD Deployment otomatis â€¢ SSL Enkripsi â€¢ Server regional Asia (latency rendah) â€¢ Logging, analytics, dan backup rutin â€¢ Dapat di-upgrade ke sistem portal tanpa rebuild. | 4.000.000           |
|                    3                     | Keamanan & Backup Harian                   | Setup firewall, HTTPS enforcement, policy-based access, dan backup otomatis ke storage cloud.                                                                                                                                                                                    | 1.000.000           |
| **Subtotal Infrastruktur & Development** |                                            |                                                                                                                                                                                                                                                                                  | **5.800.000**       |

4. ### **MAINTENENCE DAN PEMELIHARAAN SERVER**

|                        No                        | Uraian                     | Rincian Kegiatan                                                    | Estimasi Biaya (Rp) |
| :----------------------------------------------: | -------------------------- | ------------------------------------------------------------------- | ------------------- |
|                        1                         | Pengujian dan Pemeliharaan | Melakukan pengujian penggunaan selama 1 bulan dan analisa bug/error | 1.000.000           |
| **Subtotal Maintenence dan Pemeliharaan Server** |                            |                                                                     | **1.000.000**       |

**Catatan Penting:**

Infrastruktur dibuat dengan arsitektur **scalable dan secure**, Dapat menangani lonjakan traffic publik (misalnya pengumuman program / pelatihan besar), dan siap dikembangkan ke sistem portal tanpa migrasi server.

5. ## **REKAP TOTAL**

| Komponen                   | Estimasi Biaya (Rp) |
| -------------------------- | ------------------- |
| Design & UI                | 4.000.000           |
| Development Website        | 8.000.000           |
| Infrastruktur & Deployment | 5.800.000           |
| Maintenence & Pemeliharaan | 1.000.000           |
| **TOTAL KESELURUHAN**      | **18.800.000**      |

6. ## **Rencana Waktu Pelaksanaan**

| Tahap                 | Durasi                | Output                     |
| --------------------- | --------------------- | -------------------------- |
| Desain UI/Ux          | 4 Hari                | Layout & Style Guide       |
| Development           | 30 Hari               | Website Fungsional         |
| Testing & Maintenance | 4 Hari                | QA & Optimasi              |
| Launching             | 2 Hari                | Deploy ke Domain Resmi     |
| **TOTAL DURASI**      | **Â±5 minggu efektif** | **Website siap digunakan** |

7. ## **Termin Pembayaran**

| Termin                        | Persentase         | Waktu Pembayaran                                                     | Keterangan                                          |
| ----------------------------- | ------------------ | -------------------------------------------------------------------- | --------------------------------------------------- |
| Termin 1 \- DP Awal           | 30% (Rp 5.640.000) | Setelah dokumen RAB disetujui & kontrak kerja ditandatangani         | Untuk memulai desain & Setup proyek                 |
| Termin 2 \- Pengembangan      | 40% (Rp 7.520.000) | Setelah tahap development website selessai (fitur utama berfungsi)   | Meliputi UI/UX, frontend, backend dan infrastruktur |
| Termin 3 \- Final & Launching | 30% (Rp 5.640.000) | Setelah testing, revisi akhir, dan website resmi di-deploy ke domain | Deploy ke Domain Resmi                              |

# Auth

# **1\) Alur Pengguna (End-to-End)**

**Landing Page â†’ â€œBergabungâ€ â†’ Pilih Peran â†’ Registrasi â†’ Onboarding â†’ Dashboard**

1. **Klik â€œBergabungâ€** di landing

2. **Pilih Peran** (wajib):

   - **Lulusan/Mahasiswa** (â†’ role: `candidate`)

   - **Mitra BLK/LPK** (â†’ role: `institution`)

   - **Perusahaan/Employer** (â†’ role: `employer`)

3. **Registrasi** (berdasarkan peran):

   - Metode: **Email+Password**, **Google OAuth**, **No. Telp (OTP)**

   - Simpan `intended_role` dari langkah pilih peran

4. **Onboarding** (halaman pertama setelah signup sukses):

   - **Candidate:** lengkapi profil \+ **Generate CV**

   - **Institution:** isi **Profil BLK/LPK** (alamat, legalitas, kapasitas, program)

   - **Employer:** isi **Info Perusahaan** (NIB/NPWP opsional, bidang, alamat, PIC)

5. **Role Gate**: jika onboarding belum lengkap â†’ tetap diarahkan ke wizard; kalau lengkap â†’ **Dashboard peran** (Candidate/Institution/Employer).

6. **Admin Review (opsional)**: untuk `institution` & `employer`, boleh diberi **status: pending_approval** sebelum akses penuh.

---

# **2\) Struktur Halaman (Next.js App Router)**

- `/join` â†’ pilih peran (Candidate / Institution / Employer)

- `/auth/register?role={candidate|institution|employer}`

- `/auth/login`

- `/auth/forgot-password`

- `/onboarding/candidate` â†’ wizard profil \+ generate CV

- `/onboarding/institution` â†’ wizard profil BLK/LPK

- `/onboarding/employer` â†’ wizard profil perusahaan

- `/dashboard/candidate`

- `/dashboard/institution`

- `/dashboard/employer`

- `/pending-approval` (untuk institution/employer jika perlu verifikasi)

---

# **3\) Form & Validasi per Peran**

### **3.1 Candidate (Lulusan/Mahasiswa)**

**Langkah 1: Data Pribadi**

- Nama lengkap\* (â‰¥3 char)

- Email\* (readonly jika dari OAuth)

- No. telp\* (OTP opsional)

- Tgl lahir\* (â‰¥ 15 tahun)

- Jenis kelamin (opsional)

- Alamat (kota/kabupaten, provinsi)\*

**Langkah 2: Pendidikan**

- Jenjang terakhir\* (SMA/SMK/D3/S1/â€¦)

- Jurusan\*

- Tahun lulus\*

- IPK (opsional)

- **Status**: Lulusan / Mahasiswa Aktif\*

**Langkah 3: Pengalaman & Skill**

- Pengalaman kerja (array: perusahaan, posisi, periode, deskripsi)

- Skill\* (min 3), level (Beginner/Intermediate/Advanced)

- Bahasa (EN/JPN) \+ **JLPT level** (opsional)

- Portofolio/LinkedIn (opsional)

**Langkah 4: Dokumen**

- Upload: CV (opsional jika mau **Generate CV**), Ijazah, KTP, Sertifikat

**Langkah 5: Generate CV**

- Pilih template (A/B) â†’ preview â†’ **Export PDF** â†’ simpan `cv_url`

- Checklist selesai â†’ direct ke `/dashboard/candidate`

**Validasi utama:** field bertanda \* wajib; minimal 1 dokumen; min 3 skill; sanitasi URL.

---

### **3.2 Institution (Mitra BLK/LPK)**

**Langkah 1: Data Lembaga**

- Nama lembaga\*

- Jenis: **BLK Pemerintah / BLK Pesantren / LPK** \*

- NIB/izin operasional (opsional, tapi dianjurkan)

- Alamat lengkap\*, kota/kabupaten\*, provinsi\*

- Koordinat (lat/lng) untuk peta (opsional)

**Langkah 2: Kontak & PIC**

- Email lembaga\*, telepon kantor\*

- Nama PIC\*, jabatan\*, no. telp\*, email\*

**Langkah 3: Kapasitas & Fasilitas**

- Kapasitas peserta per bulan/kuartal\*

- Fasilitas: ruang kelas, lab, asrama, peralatan (checkbox)

- Bidang keahlian utama\* (list)

**Langkah 4: Program Utama**

- Daftar program (Bahasa Jepang/Desain/Digital/Manufaktur, dsb)

- Skema sertifikasi (BNSP/dll) (opsional)

**Langkah 5: Review & Submit**

- Status awal: `pending_approval` (opsi) â†’ Admin verifikasi â†’ `approved`

- Approved â†’ `/dashboard/institution`

---

### **3.3 Employer (Perusahaan)**

**Langkah 1: Data Perusahaan**

- Nama perusahaan\*

- Bidang industri\*

- Website/Profil publik (opsional)

- Alamat kantor\*, kota/kabupaten\*, provinsi\*

**Langkah 2: Legal & Kontak**

- NIB/NPWP (opsional)

- PIC HR\*: nama\*, email\*, telp\*

**Langkah 3: Preferensi Rekrutmen**

- Lokasi kerja (IDN/JP/Hybrid)

- Jenis posisi umum (operator, kreatif, IT, dsb)

- Catatan kebutuhan (opsional)

**Langkah 4: Review & Submit**

- Status awal `pending_approval` (opsi) â†’ Admin verifikasi â†’ `approved`

- Approved â†’ `/dashboard/employer` (bisa **posting loker** bila role diizinkan)

---

# **4\) Skema Data (Supabase â€“ ringkas)**

### **4.1 Users & Roles**

- `auth.users` (bawaan Supabase)

- **`profiles`**

  - `id` (uuid, pk, \= auth.uid)

  - `role` (`candidate` | `institution` | `employer` | `admin`)

  - `full_name`, `phone`, `city`, `province`, `avatar_url`

  - `onboarding_completed` (bool)

  - `created_at`

- **`user_roles`** (opsional multi-role)

  - `user_id`, `role`, `status` (`pending_approval`/`approved`/`rejected`)

### **4.2 Candidate**

- **`candidate_profiles`** (1â€“1)

  - `user_id` (pk, fk)

  - `education_level`, `major`, `graduation_year`, `gpa`, `is_student`

  - `skills` (text\[\]), `languages` (jsonb: {code, level}), `jlpt_level`

  - `cv_url`

- **`candidate_experiences`** (1â€“n)

  - `user_id`, `company`, `position`, `start_date`, `end_date`, `desc`

- **`documents`**

  - `user_id`, `type` (`KTP`, `IJAZAH`, `SERTIFIKAT`, `CV`), `file_url`, `verified`

### **4.3 Institution**

- **`institutions`** (1â€“1 per user)

  - `user_id` (owner), `name`, `type` (`blk_pemerintah`/`blk_pesantren`/`lpk`),

  - `address`, `city`, `province`, `lat`, `lng`,

  - `email`, `phone`, `pic_name`, `pic_position`, `pic_phone`, `pic_email`,

  - `capacity_month`, `facilities` (text\[\]), `specialties` (text\[\]),

  - `status` (`pending_approval`/`approved`/`rejected`)

### **4.4 Employer**

- **`employers`** (1â€“1 per user)

  - `user_id`, `company_name`, `industry`, `website`,

  - `address`, `city`, `province`,

  - `nib`, `npwp` (optional),

  - `pic_name`, `pic_email`, `pic_phone`,

  - `status`

**Index & Constraints**: pk/fk pada `user_id`, unique pada entitas 1â€“1, index `status` untuk approval queue.

---

# **5\) Kebijakan Keamanan (RLS â€“ garis besar)**

- **`profiles`**:

  - `select`: user dapat melihat dirinya; admin dapat melihat semua.

  - `update`: hanya pemilik (`auth.uid() = id`) atau admin.

- **`candidate_*`**:

  - hanya pemilik; admin read.

- **`institutions` / `employers`**:

  - `insert`: oleh pemilik; `status = 'pending_approval'` default.

  - `select`:

    - publik hanya field yang **public_safe** (nama, kota, bidang).

    - detail penuh hanya owner & admin.

  - `update`: owner hanya saat `status != approved` (atau izinkan edit terbatas), admin selalu.

- **Dokumen/Storage**:

  - Bucket terpisah (`private`) untuk dokumen identitas; generate **signed URL**.

---

# **6\) Server Actions / API (contoh)**

- `POST /api/auth/set-role` â†’ simpan `intended_role` setelah /join

- `POST /api/onboarding/candidate` â†’ upsert `profiles`, `candidate_profiles`, `documents`

- `POST /api/onboarding/institution` â†’ upsert `institutions` (â†’ `pending_approval`)

- `POST /api/onboarding/employer` â†’ upsert `employers` (â†’ `pending_approval`)

- `POST /api/cv/generate` â†’ render CV (React-PDF/Puppeteer) â†’ upload ke storage â†’ `cv_url`

- `GET /api/me` â†’ profil \+ status onboarding \+ role route

Untuk Next.js App Router, pakai **Server Actions** (+ Zod untuk validasi), atau **route handlers** di `app/api/*`.

---

# **7\) UI/UX Wizard (detail interaksi)**

- **Stepper** di onboarding: Step 1â€“4 (progress bar 0â€“100%).

- **Autosave** tiap blur/tiap step (optimistic update).

- **Guard**: bila reload sebelum selesai, kembali ke step terakhir.

- **Toast** untuk error validasi & sukses.

- **CTA**: â€œLanjutkan nantiâ€ (simpan draft).

---

# **8\) Email/OTP & Notifikasi**

- **Verifikasi email** saat signup (Supabase Auth).

- **Optional OTP telp/WA** (Fonnte/Twilio) untuk `phone_verified`.

- Email template:

  - Welcome (peran berbeda),

  - Onboarding reminder (jika belum selesai),

  - Approval status (institution/employer).

---

# **9\) Edge Cases & Aturan**

- **Ganti peran** setelah daftar:

  - izinkan _request role change_ (admin approve), atau

  - izinkan multi-role (`user_roles`), pilih aktif saat login.

- **OAuth tanpa email verifikasi**: paksa tambah email/no. telp.

- **Dokumen sensitif**: hanya owner & admin yang bisa lihat/unduh.

- **Approval Queue**: halaman `/admin/approvals` untuk meninjau `institutions/employers`.

---

# **10\) Acceptance Criteria (ringkas)**

- Dari landing, user bisa pilih peran & diarahkan ke register sesuai peran.

- Registrasi berhasil (email/Google/OTP) â†’ diarahkan ke wizard onboarding peran.

- Candidate bisa melengkapi profil & **generate CV** (PDF tersimpan).

- Institution & Employer dapat submit profil â†’ status `pending_approval`.

- User yang belum selesai onboarding **tidak** bisa ke dashboard (redirect wizard).

- Setelah onboarding selesai (atau approved), user masuk **dashboard perannya**.

- RLS memastikan data profil hanya dapat diakses pemilik & admin.

- Semua formulir tervalidasi (server & client), autosave berjalan.

---

## **Bonus: Backlog Teknis (siap dipecah ke tickets)**

- FE: `/join`, `/auth/register`, `/onboarding/*` stepper \+ autosave

- BE: server actions `upsertProfile`, `generateCV`, `submitInstitution`, `submitEmployer`

- DB: migrasi tabel sesuai skema \+ RLS policy

- Storage: bucket `docs` (private), bucket `public-assets` (logo dsb)

- Email: templates (welcome, approval, reminder)

- QA: test flow semua peran, test RLS (query langsung), test generate CV

# Jobs

# **1\) Alur Pengguna (End-to-End)**

**Publik/Kandidat**

1. `/jobs` â†’ cari & filter lowongan

2. `/jobs/[id]` â†’ baca detail â†’ **Apply** (kalau internal) / **Kunjungi** (kalau eksternal)

3. Jika belum login â†’ auth \+ onboarding singkat kandidat

4. **Apply**: pilih CV (upload / pakai **Generate CV**), jawab pertanyaan screening (opsional)

5. Lihat **status lamaran** di `/applications` (submitted â†’ screening â†’ interview â†’ offer â†’ hired/rejected)

**Employer/Admin**

1. `/dashboard/employer/jobs` â†’ **Create Job** (internal/eksternal)

2. **Publish/Unpublish/Close** \+ kelola pelamar per lowongan

3. Update status lamaran; jadwalkan interview; export data

4. Admin bisa **approve** job employer baru (opsional workflow)

---

# **2\) Struktur Halaman (Next.js App Router)**

**Publik/Kandidat**

- `/jobs` (list \+ filter \+ pagination)

- `/jobs/[id]` (detail \+ CTA)

- `/applications` (riwayat lamaran kandidat)

- `/applications/[id]` (detail lamaranâ€”opsional)

**Employer/Admin**

- `/dashboard/employer/jobs` (list & status)

- `/dashboard/employer/jobs/new` (buat)

- `/dashboard/employer/jobs/[id]` (edit \+ pelamar)

- `/dashboard/admin/jobs` (moderasi/approvalâ€”opsional)

---

# **3\) Fitur & Aturan per Peran**

### **A. Publik/Kandidat**

- **Browse & Filter**: kata kunci, lokasi, negara, kategori, internal/eksternal, tipe kerja, gaji, sebelum deadline

- **Detail Job**: deskripsi, syarat (JLPT, usia, pendidikan), info perusahaan/BLK, benefit, kuota

- **Apply Internal**:

  - Cek kelengkapan profil (minimal: data pribadi, pendidikan, 3 skill, CV)

  - Upload CV / pakai CV dari profil

  - Screening Q\&A (opsional): 2â€“5 pertanyaan (short answer)

  - Kirim â†’ status awal **submitted**

- **Lowongan Eksternal**: tombol â€œKunjungiâ€ (tracking klik)

- **Riwayat Lamaran**: status, jadwal interview, catatan HR, unduh bukti

### **B. Employer**

- **CRUD** lowongan milik sendiri

- Set **tipe**: internal (apply di sistem) / eksternal (link out)

- Set **deadline**, **quota**, **salary range**, **requirements** (json)

- **Pelamar**: lihat data profil+CV, shortlist, ubah status, jadwal interview

- **Export** pelamar (CSV)

### **C. Admin**

- CRUD semua job

- **Approval** job employer baru (opsional)

- Moderasi konten (kata terlarang, spam)

- Analytics: pelamar per job, time-to-fill, sumber traffic (UTM)

---

# **4\) Model Data (Supabase â€“ Ringkas)**

### **Tabel inti**

**`jobs`**

- `id` (uuid, pk)

- `title` (text), `slug` (text unique)

- `organization_id` (uuid fk â†’ employers / institutions)

- `is_internal` (bool) â€” true \= aplikasi di sistem

- `external_url` (text, nullable)

- `location_city` (text), `location_country` (text)

- `employment_type` (enum: fulltime/parttime/internship/contract)

- `category` (text)

- `requirements` (jsonb) â€” {education, jlpt, age_min, skills\[\]}

- `description` (text), `benefits` (text)

- `salary_min` (int), `salary_max` (int), `currency` (text)

- `quota` (int)

- `deadline` (date)

- `status` (enum: draft/pending/published/closed/archived)

- `created_by` (uuid fk â†’ auth.users)

- `created_at`, `updated_at`

**`applications`**

- `id` (uuid, pk)

- `job_id` (uuid fk â†’ jobs)

- `user_id` (uuid fk â†’ auth.users)

- `resume_url` (text) // bisa auto dari profil

- `answers` (jsonb) // jawaban screening

- `status` (enum: submitted/screening/interview/offer/hired/rejected)

- `notes` (text) // catatan HR

- `interview_at` (timestamptz, nullable)

- `created_at`, `updated_at`

- unique constraint: (`job_id`, `user_id`) â€” 1 kandidat 1 lamaran per job

**`employers`** (kalau belum ada pada modul auth)

- `id` (uuid pk \= owner user) atau `org_id` terpisah

- `company_name`, `industry`, `city`, `province`, `status` (pending/approved)

- dsb (lihat modul auth)

**Indeks yang disarankan**

- `idx_jobs_status_deadline` (status, deadline)

- `idx_jobs_text_search` (title, description) â€” pakai **pg_trgm** atau **tsvector**

- `idx_apps_job_id_status` (job_id, status)

- `idx_apps_user_id` (user_id)

---

# **5\) RLS (Row Level Security) â€“ Garis Besar**

**`jobs`**

- `select`:

  - publik: `status = 'published' AND (deadline IS NULL OR deadline >= now())`

  - employer: job yang `created_by = auth.uid()`

  - admin: semua

- `insert/update/delete`:

  - employer: hanya job `created_by = auth.uid()`

  - admin: semua

**`applications`**

- `select`:

  - candidate: `user_id = auth.uid()`

  - employer: join ke `jobs.created_by = auth.uid()` (lihat pelamar hanya untuk job miliknya)

  - admin: semua

- `insert`:

  - candidate only; to job `status='published'` & within deadline; **unique (job_id,user_id)**

- `update`:

  - candidate: hanya boleh batalkan (opsional), atau **tidak boleh** sama sekali

  - employer/admin: boleh update `status`, `notes`, `interview_at` pada aplikasi job miliknya

---

# **6\) Validasi & Aturan Bisnis**

**Saat publish job (internal):**

- `title`, `description`, `requirements` minimal terisi

- `deadline` â‰¥ today

- `status` diubah ke `published`

**Saat apply:**

- Jika `is_internal = false` â†’ tidak bisa apply (redirect ke `external_url`)

- Kandidat harus memiliki:

  - `profiles.onboarding_completed = true`

  - minimal 3 `skills`, `education_level` terisi

  - `cv_url` tersedia **atau** upload `resume_url` pada apply

**Penutupan job:**

- Otomatis `closed` jika lewat `deadline`, tetapi **halaman tetap bisa dibaca** (tanpa tombol apply)

---

# **7\) Server Actions / API (Contoh)**

`// GET /api/jobs (list)`  
`getJobs({ q, category, city, country, isInternal, page, pageSize })`

`// GET /api/jobs/[id]`  
`getJobDetail(id)`

`// POST /api/jobs (employer/admin)`  
`createJob(payload)  // validasi zod, sanitize, set status=draft`

`// PUT /api/jobs/[id]`  
`updateJob(id, payload)`

`// POST /api/jobs/[id]/publish`  
`publishJob(id) // cek validasi, set status=published`

`// POST /api/applications`  
`applyJob({ jobId, resumeUrl?, answers? })  // candidate only`

`// PUT /api/applications/[id]/status`  
`updateApplicationStatus({ id, status, interviewAt?, notes? }) // employer/admin`

Implementasi: **Next.js Server Actions** \+ **Supabase client (server)**, validasi **zod**, audit log opsional.

---

# **8\) UI/UX â€“ Komponen Inti**

**Publik/Kandidat**

- `JobsFilterBar`: search \+ select (kategori, lokasi, internal/eksternal, tipe)

- `JobCard`: ringkas (judul, perusahaan, lokasi, badge internal/eksternal, deadline)

- `JobDetail`: tab Deskripsi/Syarat/Benefit/Perusahaan

- `ApplyDialog`: upload/pilih CV, form Q\&A, ringkasan syarat

- `ApplicationsTable`: status lamaran \+ actions (view detail, withdraw opsional)

**Employer/Admin**

- `JobForm`: title, desc, req (chip input skill), salary slider, deadline, toggle internal/eksternal

- `JobsTable`: kolom status, deadline, applicants count, actions (publish/close)

- `ApplicantsList`: filter status, quick actions (shortlist, schedule)

- `ApplicantDrawer`: profil kandidat, CV preview, timeline status

**UX Notes**

- Badge warna:

  - **Internal**: oranye (apply di sistem)

  - **Eksternal**: abu (link keluar)

- Status aplikasi berbentuk **stepper/timeline**

- **Empty states** informatif \+ CTA (contoh: â€œBelum ada lowongan. Tambah sekarang.â€)

---

# **9\) Notifikasi & Integrasi**

**Trigger**

- Apply masuk â†’ email ke employer/PIC

- Perubahan status â†’ email ke kandidat

- 24h sebelum interview â†’ pengingat (email/WA)

- Job mendekati deadline â†’ reminder ke employer (opsional)

**Channel**

- Email (Resend/SendGrid)

- WhatsApp (Fonnte/Twilio) (opsionalâ€”set nanti)

---

# **10\) Acceptance Criteria (Checklist)**

- Publik bisa melihat daftar lowongan terfilter & tersortir

- Detail job tampil lengkap; tombol **Apply** hanya muncul jika `is_internal=true`, `status=published`, belum lewat deadline

- Kandidat bisa apply (dengan CV dari profil atau upload baru) dan melihat statusnya

- Employer bisa **create/publish/close** lowongan & melihat pelamar job miliknya

- Employer/Admin dapat mengubah **status lamaran** (screening â†’ interview â†’ offer â†’ hired/rejected)

- RLS menegakkan batas akses (kandidat hanya lamaran sendiri; employer hanya pelamar job miliknya)

- Deadline menutup apply otomatis

- Audit basic (timestamps) terekam

---

## **(Opsional) DDL Singkat â€“ Contoh Supabase**

`create type job_status as enum ('draft','pending','published','closed','archived');`  
`create type app_status as enum ('submitted','screening','interview','offer','hired','rejected');`

`create table jobs (`  
 `id uuid primary key default gen_random_uuid(),`  
 `title text not null,`  
 `slug text unique not null,`  
 `organization_id uuid references employers(id),`  
 `is_internal boolean not null default true,`  
 `external_url text,`  
 `location_city text,`  
 `location_country text,`  
 `employment_type text,`  
 `category text,`  
 `requirements jsonb default '{}'::jsonb,`  
 `description text not null,`  
 `benefits text,`  
 `salary_min int,`  
 `salary_max int,`  
 `currency text default 'IDR',`  
 `quota int,`  
 `deadline date,`  
 `status job_status not null default 'draft',`  
 `created_by uuid not null references auth.users(id),`  
 `created_at timestamptz default now(),`  
 `updated_at timestamptz default now()`  
`);`

`create table applications (`  
 `id uuid primary key default gen_random_uuid(),`  
 `job_id uuid not null references jobs(id) on delete cascade,`  
 `user_id uuid not null references auth.users(id) on delete cascade,`  
 `resume_url text,`  
 `answers jsonb,`  
 `status app_status not null default 'submitted',`  
 `notes text,`  
 `interview_at timestamptz,`  
 `created_at timestamptz default now(),`  
 `updated_at timestamptz default now(),`  
 `unique (job_id, user_id)`  
`);`

RLS & policy mengikuti garis besar di atas (candidate/employer/admin).

# Training

# **1\) Alur Pengguna (End-to-End)**

**Publik/Kandidat**

1. `/trainings` â†’ jelajah program (filter: kategori, penyelenggara, mode, status)

2. `/trainings/[programId]` â†’ baca detail program â†’ lihat kelas/jadwal aktif

3. Pilih kelas â†’ **Daftar/Enroll** (cek kelengkapan profil & syarat)

4. Lihat status di `/enrollments` (applied â†’ confirmed â†’ in_progress â†’ completed/failed)

5. Setelah selesai & lulus â†’ **sertifikat digital** (QR verifikasi) dapat diunduh

**LPK/BLK (Institution) / Admin**

1. `/dashboard/institution/trainings` â†’ **buat Program** (judul, deskripsi, kategori, prasyarat)

2. Tambah **Kelas/Jadwal** (tanggal, venue, kapasitas, mode, biaya opsional)

3. **Kelola pendaftar** (approve/deny/waitlist), absensi, nilai, kelulusan

4. Generate **sertifikat** untuk peserta lulus

5. Publikasikan **laporan batch** (opsional: artikel kegiatan)

---

# **2\) Struktur Halaman (Next.js App Router)**

**Publik/Kandidat**

- `/trainings` (list \+ filter \+ pagination)

- `/trainings/[programId]` (detail program \+ list kelas)

- `/classes/[classId]` (detail kelas \+ CTA daftar)

- `/enrollments` (riwayat & status)

**Institution/Admin**

- `/dashboard/institution/trainings` (list program)

- `/dashboard/institution/trainings/new` (buat program)

- `/dashboard/institution/trainings/[programId]` (edit \+ kelas)

- `/dashboard/institution/classes/[classId]` (kelola peserta, absensi, nilai, sertifikat)

- `/dashboard/admin/trainings` (moderasi lintas lembagaâ€”opsional)

---

# **3\) Fitur & Aturan per Peran**

### **A. Publik/Kandidat**

- **Browse & Filter**: kategori (Bahasa Jepang, Digital, Manufaktur, dsb), penyelenggara (LPK/BLK), mode (online/offline/hybrid), status (open/closed/ongoing/completed), berbiaya/gratis

- **Detail Program**: deskripsi, prasyarat, kompetensi hasil belajar, durasi tipikal, penyelenggara

- **List Kelas**: tanggal mulaiâ€“akhir, venue/zoom, kapasitas, **status pendaftaran** (open/closed/waitlist), biaya (opsional)

- **Daftar/Enroll**:

  - Validasi prasyarat (mis. JLPT N5, skill minimal)

  - Upload dokumen tambahan (opsional)

  - Set status awal **applied** â†’ menunggu konfirmasi penyelenggara

- **Progres & Sertifikat**:

  - Lihat status (confirmed â†’ in_progress â†’ completed/failed)

  - Unduh sertifikat (jika lulus)

### **B. LPK/BLK (Institution)**

- **CRUD Program & Kelas** (hanya milik organisasinya)

- **Kelola Pendaftar**:

  - Approve/deny/waitlist; kapasitas otomatis terhitung

  - Komunikasi peserta (email/WA template)

- **Absensi & Penilaian**:

  - Input kehadiran per pertemuan

  - Nilai akhir / kelulusan

- **Generate Sertifikat**:

  - Template brandable, nomor sertifikat, QR verifikasi

  - Unggah tanda tangan digital (opsional)

### **C. Admin**

- Lihat & moderasi semua program/kelas lintas lembaga

- Batasan konten (larangan, spam)

- Agregasi laporan tingkat provinsi (jumlah batch, peserta, completion rate)

---

# **4\) Model Data (Supabase â€“ Ringkas)**

### **Tabel inti**

**`training_programs`**

- `id` (uuid, pk)

- `title` (text), `slug` (unique)

- `provider_id` (uuid fk â†’ institutions.id)

- `category` (text)

- `description` (text)

- `prerequisites` (jsonb) â€” {jlpt, skills\[\], education, age_min?}

- `mode` (enum: online/offline/hybrid)

- `status` (enum: draft/published/archived)

- `is_external` (bool) & `external_url` (nullable)

- `created_by` (uuid fk â†’ auth.users)

- `created_at`, `updated_at`

**`training_classes`**

- `id` (uuid, pk)

- `program_id` (uuid fk â†’ training_programs.id)

- `start_date` (date), `end_date` (date)

- `schedule_json` (jsonb) // sesi per tanggal (opsional)

- `venue` (text) // alamat/zoom link

- `capacity` (int)

- `enrollment_status` (enum: open/closed/waitlist)

- `fee_amount` (int, nullable), `currency` (text, default 'IDR')

- `status` (enum: upcoming/ongoing/completed/cancelled)

- `created_at`, `updated_at`

**`enrollments`**

- `id` (uuid, pk)

- `class_id` (uuid fk â†’ training_classes.id on delete cascade)

- `user_id` (uuid fk â†’ auth.users.id on delete cascade)

- `status` (enum: applied/confirmed/in_progress/completed/failed/cancelled)

- `attendance_json` (jsonb) // { "2025-10-01": true, ... }

- `score` (numeric, nullable), `remarks` (text)

- `certificate_url` (text, nullable)

- `created_at`, `updated_at`

- unique (`class_id`,`user_id`)

**`certificates`** (opsional, jika dipisah)

- `id`, `enrollment_id` (unique fk), `number`, `issued_at`, `pdf_url`, `verify_token`

**Indeks yang disarankan**

- `idx_programs_status_category_provider`

- `idx_classes_program_status_enrollment`

- `idx_enrollments_user_status`

---

# **5\) RLS (Row Level Security) â€“ Garis Besar**

**`training_programs`**

- `select`: publik bisa lihat yang `status='published'` & `is_external OR provider.status='approved'`

- `insert/update/delete`:

  - **Institution**: hanya untuk `provider_id` miliknya (`institutions.user_id = auth.uid()`), tergantung model kepemilikan

  - **Admin**: semua

**`training_classes`**

- `select`: publik boleh lihat kelas dari `program.status='published'`

- `insert/update/delete`: owner institution & admin

**`enrollments`**

- `select`:

  - Kandidat: hanya miliknya (`user_id = auth.uid()`)

  - Institution: hanya untuk kelas dalam `program.provider_id` miliknya (join)

  - Admin: semua

- `insert`: kandidat untuk kelas `enrollment_status='open'`

- `update`:

  - Institution/Admin ubah `status/attendance/score/certificate_url`

  - Kandidat bisa `cancel` (opsional, sebelum `confirmed`)

---

# **6\) Validasi & Aturan Bisnis**

**Publish Program**

- `title`, `description`, `category`, `mode` terisi

- jika `is_external=true` â†’ butuh `external_url` (apply disabled)

**Buat Kelas**

- `start_date â‰¤ end_date`, `capacity â‰¥ 1`

- `enrollment_status` default `open`, auto `closed` jika kapasitas penuh (opsional)

**Enroll**

- Kandidat harus **onboarding lengkap** (profil minimal \+ dokumen yang disyaratkan)

- Cek `enrollment_status='open'` & kapasitas tersisa \> 0

- Set status awal `applied` â†’ **institution confirm** â†’ `confirmed`

**Status kelas otomatis**

- `upcoming` â†’ ketika `now() < start_date`

- `ongoing` â†’ `start_date â‰¤ now() â‰¤ end_date`

- `completed` â†’ `now() > end_date` (atau manual)

**Sertifikat**

- Diterbitkan ketika `status='completed'` dan `score`/kriteria lulus terpenuhi

- Simpan `certificate_url` & (opsional) buat record `certificates` dengan `verify_token` random â†’ **URL verifikasi** publik

---

# **7\) Server Actions / API (Contoh)**

`// PROGRAM`  
`listPrograms({ q, category, mode, providerId, isExternal, page, pageSize })`  
`getProgramDetail(programId)`  
`createProgram(payload)               // institution/admin`  
`updateProgram(programId, payload)    // institution owner/admin`  
`publishProgram(programId)            // validasi & set status`

`// CLASS`  
`listClassesByProgram(programId)`  
`getClassDetail(classId)`  
`createClass(programId, payload)      // institution/admin`  
`updateClass(classId, payload)        // institution owner/admin`  
`setEnrollmentStatus(classId, 'open'|'closed'|'waitlist')`

`// ENROLLMENT`  
`enrollClass({ classId })             // candidate only`  
`updateEnrollmentStatus({ id, status }) // institution/admin`  
`recordAttendance({ id, date, present })`  
`setScore({ id, score, remarks })`  
`issueCertificate({ id })             // generate PDF, upload, save url/token`

Validasi **Zod**, jalankan di **Server Actions** (Next.js), akses DB via Supabase server client.

---

# **8\) UI/UX â€“ Komponen Inti**

**Publik/Kandidat**

- `TrainingFilterBar` (search, kategori, mode, penyelenggara)

- `ProgramCard` (judul, kategori, provider, ringkas prasyarat)

- `ProgramDetail` (tab: Overview, Prasyarat, Kelas)

- `ClassCard` (tanggal, venue/zoom, kapasitas, status pendaftaran)

- `EnrollDialog` (cek profil, upload dokumen tambahan bila disyaratkan)

- `EnrollmentsTable` (status, jadwal, progres, sertifikat)

**Institution/Admin**

- `ProgramForm` (judul, deskripsi, prasyarat json builder, mode)

- `ClassForm` (tanggal, venue, kapasitas, biaya, status pendaftaran)

- `ApplicantsList` (pendaftar per kelas: approve/deny/waitlist)

- `AttendanceSheet` (tabel kehadiran per pertemuan)

- `ScoreForm` (nilai & kelulusan)

- `CertificatePreview` (nomor sertifikat \+ QR)

**UX Notes**

- **Stepper** untuk pendaftaran (cek prasyarat â†’ konfirmasi data â†’ submit)

- **Badge warna**: status pendaftaran (open/closed/waitlist), status kelas (upcoming/ongoing/completed)

- **Empty state** dengan CTA â€œLihat Kelas Lainâ€ bila kelas penuh/closed

---

# **9\) Notifikasi & Integrasi**

**Trigger**

- Pendaftaran masuk â†’ email ke penyelenggara

- Status pendaftaran berubah (confirmed/denied) â†’ email ke peserta

- Pengingat H-1 sebelum kelas mulai (opsional WA)

- Sertifikat diterbitkan â†’ email link unduhan \+ link verifikasi publik

**Channel**

- Email (Resend/SendGrid)

- WhatsApp (Fonnte/Twilio) â€“ opsional

---

# **10\) Acceptance Criteria (Checklist)**

- Publik bisa melihat daftar program & kelas dengan filter yang relevan

- Detail program memuat prasyarat, kompetensi, provider, dan daftar kelas aktif

- Kandidat bisa **enroll** ke kelas `open`, dengan validasi prasyarat & kapasitas

- LPK/BLK dapat **CRUD program & kelas** miliknya dan **kelola pendaftar**

- Absensi dan nilai dapat diinput; status enrolment berubah sesuai progres

- Sertifikat digital dapat diterbitkan & diverifikasi

- RLS menegakkan akses (kandidat hanya enrolment miliknya; institution hanya kelasnya)

- Status kelas & pendaftaran mengikuti aturan tanggal & kapasitas

---

## **(Opsional) DDL Singkat â€“ Contoh Supabase**

`create type program_status as enum ('draft','published','archived');`  
`create type class_status as enum ('upcoming','ongoing','completed','cancelled');`  
`create type enroll_status as enum ('applied','confirmed','in_progress','completed','failed','cancelled');`  
`create type enroll_open as enum ('open','closed','waitlist');`

`create table training_programs (`  
 `id uuid primary key default gen_random_uuid(),`  
 `title text not null,`  
 `slug text unique not null,`  
 `provider_id uuid not null references institutions(id),`  
 `category text,`  
 `description text,`  
 `prerequisites jsonb default '{}'::jsonb,`  
 `mode text check (mode in ('online','offline','hybrid')),`  
 `status program_status not null default 'draft',`  
 `is_external boolean not null default false,`  
 `external_url text,`  
 `created_by uuid not null references auth.users(id),`  
 `created_at timestamptz default now(),`  
 `updated_at timestamptz default now()`  
`);`

`create table training_classes (`  
 `id uuid primary key default gen_random_uuid(),`  
 `program_id uuid not null references training_programs(id) on delete cascade,`  
 `start_date date not null,`  
 `end_date date not null,`  
 `schedule_json jsonb,`  
 `venue text,`  
 `capacity int not null check (capacity > 0),`  
 `enrollment_status enroll_open not null default 'open',`  
 `fee_amount int,`  
 `currency text default 'IDR',`  
 `status class_status not null default 'upcoming',`  
 `created_at timestamptz default now(),`  
 `updated_at timestamptz default now()`  
`);`

`create table enrollments (`  
 `id uuid primary key default gen_random_uuid(),`  
 `class_id uuid not null references training_classes(id) on delete cascade,`  
 `user_id uuid not null references auth.users(id) on delete cascade,`  
 `status enroll_status not null default 'applied',`  
 `attendance_json jsonb,`  
 `score numeric,`  
 `remarks text,`  
 `certificate_url text,`  
 `created_at timestamptz default now(),`  
 `updated_at timestamptz default now(),`  
 `unique (class_id, user_id)`  
`);`

# Articles

# **1\) Alur Pengguna (End-to-End)**

**Viewer (Publik)**

1. Kunjungi `/articles` â†’ telusuri artikel (search, filter kategori/tag).

2. Buka `/articles/[slug]` â†’ baca konten, lihat artikel terkait.

3. Navigasi via kategori/tag/arsip bulan.

**Admin**

1. `/dashboard/admin/articles` â†’ lihat daftar artikel (draft/published/archived).

2. Buat artikel baru (judul, isi rich text, kategori, tag, cover).

3. Simpan **draft** â†’ pratinjau â†’ **publish** (jadwal atau instan).

4. Edit/arsipkan, kelola SEO (title/description/OG image), pin artikel (featured).

---

# **2\) Struktur Halaman (Next.js App Router)**

**Publik**

- `/articles` (list \+ filter \+ pagination)

- `/articles/[slug]` (detail)

- `/categories/[category]` (opsional)

- `/tags/[tag]` (opsional)

- `/archive/[yyyy]/[mm]` (opsional)

**Admin**

- `/dashboard/admin/articles` (list \+ bulk actions)

- `/dashboard/admin/articles/new` (editor)

- `/dashboard/admin/articles/[id]` (edit)

- `/dashboard/admin/articles/settings` (kategori, tag, featured config)

---

# **3\) Fitur & Aturan per Peran**

### **A. Viewer**

- **List & Filter**: by kategori, tag, bulan/tahun, pencarian judul/isi.

- **Detail**: judul, tanggal, penulis, waktu baca (read time), cover, isi (rich), kategori/tag.

- **Navigasi**: artikel terkait (by kategori/tag), **featured** di landing.

- **Share**: tombol share (WhatsApp, X/Twitter, LinkedIn).

- **SEO**: meta tag, OpenGraph, structured data (BlogPosting).

### **B. Admin**

- **CRUD Artikel**: draft â†’ published â†’ archived (soft delete).

- **Editor Rich Text**: headings, list, quote, link, gambar (upload ke Storage), embed video/iframe (opsional).

- **SEO & Social**: custom meta title/description, OG image, canonical URL.

- **Kategori & Tag**: master data \+ assign per artikel (banyak tag).

- **Featured / Pin**: tandai artikel untuk muncul di hero/slider.

- **Scheduling**: publish terjadwal (tanggal & waktu).

- **Versioning (opsional)**: simpan revisi konten.

- **Analytics ringkas**: views, CTR dari daftar (opsional, event tracking).

- **Permissions (opsional)**: author vs editor vs admin; tapi minimal cukup admin.

---

# **4\) Model Data (Supabase â€“ Ringkas)**

**`articles`**

- `id` (uuid, pk)

- `title` (text)

- `slug` (text unique, slugify dari title)

- `excerpt` (text, ringkasan untuk list)

- `content` (text / json rich)

- `cover_url` (text, optional)

- `status` (enum: `draft` | `published` | `archived`)

- `published_at` (timestamptz, nullable)

- `author_id` (uuid fk â†’ auth.users)

- `meta_title` (text, optional)

- `meta_description` (text, optional)

- `og_image_url` (text, optional)

- `is_featured` (bool default false)

- `read_time_min` (int, opsional â€“ auto hitung)

- `created_at`, `updated_at`

**`categories`**

- `id` (uuid, pk), `name` (text unique), `slug` (unique), `created_at`

**`tags`**

- `id` (uuid, pk), `name` (text unique), `slug` (unique), `created_at`

**Relasi many-to-many**

- `article_categories` â†’ `article_id`, `category_id`, unique pair

- `article_tags` â†’ `article_id`, `tag_id`, unique pair

**(Opsional) `article_revisions`**

- `id`, `article_id`, `content_snapshot`, `updated_by`, `updated_at`

**Indeks yang disarankan**

- `idx_articles_status_published_at`

- `idx_articles_text` (title, excerpt) â€“ pg_trgm/tsvector untuk search

- `idx_article_tags_article_id`, `idx_article_categories_article_id`

---

# **5\) RLS (Row Level Security) â€“ Garis Besar**

**`articles`**

- `select`:

  - Viewer (anon/auth): hanya `status='published' AND (published_at IS NULL OR published_at <= now())`

  - Admin: semua

- `insert/update/delete`:

  - Admin only (cek role di `profiles.role='admin'`)

**`categories` / `tags` / junction tables**

- `select`: publik

- `insert/update/delete`: Admin only

**Catatan:** Untuk Admin check bisa via:

- kolom `profiles.role='admin'`, atau

- tabel `user_roles` (role-based), atau

- Supabase **Policies** dengan klaim JWT.

---

# **6\) Validasi & Aturan Bisnis**

- **Slug unik** (regenerate jika judul berubah, atau simpan `redirects` opsional).

- **Publish** hanya jika `title` dan `content` terisi.

- **Scheduled publish**: `status='draft'` \+ `published_at > now()` â†’ worker/cron (Edge Function) akan flip ke `published` saat waktunya.

- **Archive**: tidak tampil di publik, tapi bisa dipulihkan.

- **Read time**: hitung otomatis (â‰ˆ 200â€“250 kata/menit) saat simpan/publish.

---

# **7\) Server Actions / API (Contoh)**

`// LIST & DETAIL`  
`listArticles({ q, category, tag, month, year, page, pageSize })`  
`getArticleBySlug(slug)`

`// ADMIN CRUD`  
`createArticle(payload)               // status=draft`  
`updateArticle(id, payload)`  
`publishArticle(id, publishedAt?)     // now or schedule`  
`archiveArticle(id)`  
`featureArticle(id, isFeatured: boolean)`

`// TAXONOMY`  
`listCategories(); listTags()`  
`createCategory(name); createTag(name)`

Validasi **Zod**; simpan gambar ke **Supabase Storage** (bucket `public-assets/articles`), sanitize HTML untuk keamanan (DOMPurify/rehype-sanitize bila pakai HTML).

---

# **8\) UI/UX â€“ Komponen Inti**

**Publik**

- `ArticleCard` (cover, kategori, judul, excerpt, tanggal, read time)

- `ArticleList` \+ `FilterBar` (search, kategori, tag, bulan/tahun)

- `ArticleDetail` (judul besar, meta penulis/tgl, TOC opsional, â€œArtikel Terkaitâ€)

- `FeaturedSlider` (jika ada `is_featured`)

**Admin**

- `ArticlesTable` (judul, status, published_at, featured, actions)

- `ArticleEditor`:

  - Rich text editor (TipTap/MDX/Quill) \+ toolbar (H1â€“H3, bold, list, link, image, blockquote, code inline)

  - Sidebar: status, kategori, tag, cover image, SEO (meta/OG), schedule

  - Preview mode (markdown/HTML render)

- `CategoryTagManager` (CRUD kategori & tag)

- **Bulk actions**: publish/archive/feature/unfeature

- **Confirm Dialog** saat menghapus/arsip

**UX Notes**

- Auto-save draft tiap 3â€“5 detik

- Warn saat meninggalkan halaman jika ada perubahan belum tersimpan

- Keyboard shortcuts: `Ctrl/Cmd + S` simpan draft

---

# **9\) Notifikasi & Integrasi**

**Trigger**

- Publish artikel â†’ ping ke sitemap & revalidate halaman (ISR)

- (Opsional) Kirim notifikasi email/newsletter ke subscriber

- (Opsional) Auto-post ke sosial (via Zapier/IFTTT webhook)

**Teknis**

- **Revalidate**: Next.js `revalidatePath('/articles')` & `revalidateTag('article:'+slug)`

- **Sitemap**: regenerasi dinamis (route handler) saat publish

---

# **10\) Acceptance Criteria (Checklist)**

- Viewer dapat melihat daftar artikel, filter by kategori/tag/bulan, dan pencarian judul/isi

- Viewer dapat membuka detail artikel via slug; SEO meta & OG tampil benar

- Admin dapat membuat artikel **draft**, upload cover, set kategori/tag, dan **publish** (instan/terjadwal)

- Admin dapat **edit/arsip** artikel; artikel arsip tidak muncul di publik

- Artikel **featured** muncul di komponen slider/hero konten

- Kebijakan RLS mencegah non-admin melakukan write

- ISR/revalidate memperbarui halaman list & detail setelah publish/edit

- (Opsional) Statistik view/CTR dasar tampil di dashboard admin

---

## **(Opsional) DDL Singkat â€“ Supabase**

`create type article_status as enum ('draft','published','archived');`

`create table articles (`  
 `id uuid primary key default gen_random_uuid(),`  
 `title text not null,`  
 `slug text unique not null,`  
 `excerpt text,`  
 `content text not null,`  
 `cover_url text,`  
 `status article_status not null default 'draft',`  
 `published_at timestamptz,`  
 `author_id uuid not null references auth.users(id),`  
 `meta_title text,`  
 `meta_description text,`  
 `og_image_url text,`  
 `is_featured boolean not null default false,`  
 `read_time_min int,`  
 `created_at timestamptz default now(),`  
 `updated_at timestamptz default now()`  
`);`

`create table categories (`  
 `id uuid primary key default gen_random_uuid(),`  
 `name text unique not null,`  
 `slug text unique not null,`  
 `created_at timestamptz default now()`  
`);`

`create table tags (`  
 `id uuid primary key default gen_random_uuid(),`  
 `name text unique not null,`  
 `slug text unique not null,`  
 `created_at timestamptz default now()`  
`);`

`create table article_categories (`  
 `article_id uuid references articles(id) on delete cascade,`  
 `category_id uuid references categories(id) on delete cascade,`  
 `primary key (article_id, category_id)`  
`);`

`create table article_tags (`  
 `article_id uuid references articles(id) on delete cascade,`  
 `tag_id uuid references tags(id) on delete cascade,`  
 `primary key (article_id, tag_id)`  
`);`

# Dashboard

## **1\) Alur Pengguna (End-to-End)**

**Admin (Pusat / Departemen P2TK)**

1. Login â†’ masuk ke `/dashboard/admin`

2. Lihat ringkasan indikator utama (KPI) tenaga kerja:

   - Jumlah lowongan aktif

   - Jumlah pelamar & yang berhasil diterima

   - Jumlah program pelatihan & peserta aktif

   - Jumlah sertifikat diterbitkan

3. Gunakan filter berdasarkan:

   - Periode waktu (mingguan, bulanan, tahunan)

   - Lembaga/instansi (LPK/BLK)

   - Jenis program (Pelatihan / Penyaluran kerja)

   - Lokasi (Kabupaten/Kota, Provinsi)

4. Klik salah satu metrik â†’ drill down ke data detail (tabel/laporan)

5. Ekspor laporan (PDF/CSV)

**Institution (LPK/BLK)**

1. Login â†’ `/dashboard/institution`

2. Lihat KPI lembaganya sendiri:

   - Jumlah program aktif

   - Jumlah peserta terdaftar

   - Completion rate pelatihan

   - Sertifikat diterbitkan

3. Bisa menelusuri detail kelas dan peserta di bawah lembaganya.

**Employer (Perusahaan)**

1. Login â†’ `/dashboard/employer`

2. Lihat KPI rekrutmen:

   - Jumlah lowongan aktif

   - Jumlah pelamar masuk

   - Hiring rate (persentase yang diterima)

   - Rata-rata waktu rekrutmen

   ***

   ## **2\) Struktur Halaman (Next.js App Router)**

- `/dashboard/admin` â†’ Dashboard KPI utama

- `/dashboard/institution` â†’ KPI lembaga

- `/dashboard/employer` â†’ KPI rekrutmen

- `/dashboard/admin/reports` â†’ halaman laporan detail

- `/api/kpi/*` â†’ endpoint untuk data agregasi

  ***

  ## **3\) Fitur & Aturan per Peran**

  ### **A. Admin**

- Melihat **semua data lintas lembaga dan employer**

- Filter berdasarkan:

  - Periode waktu (date range)

  - Lembaga/organisasi

  - Lokasi geografis

  - Jenis kegiatan (pelatihan / rekrutmen)

- Menampilkan metrik utama:

  - Lowongan aktif

  - Jumlah pelamar

  - Hiring rate

  - Program pelatihan aktif

  - Peserta pelatihan

  - Sertifikat diterbitkan

- Menampilkan grafik:

  - Funnel Rekrutmen (Submitted â†’ Screening â†’ Interview â†’ Hired)

  - Funnel Pelatihan (Applied â†’ Confirmed â†’ In Progress â†’ Completed)

  - Time Series tren pelamar dan peserta

  - Completion rate per lembaga

  ***

  ### **B. Institution (LPK/BLK)**

- KPI internal:

  - Total program pelatihan aktif

  - Total peserta mendaftar

  - Completion rate & jumlah sertifikat

  - Jumlah kelas berjalan

- Filter by periode (30/90/180 hari)

- Bisa ekspor laporan pelatihannya sendiri

  ***

  ### **C. Employer**

- KPI rekrutmen:

  - Jumlah lowongan aktif

  - Jumlah pelamar per posisi

  - Jumlah diterima (status hired)

  - Hiring rate (% diterima)

  - Average time-to-hire

  ***

  ## **4\) Model Data (Supabase â€“ Ringkas)**

KPI akan diambil dari agregasi beberapa tabel utama:

| Tabel               | Sumber Data           | Digunakan Untuk                 |
| ------------------- | --------------------- | ------------------------------- |
| `jobs`              | Lowongan              | Total lowongan aktif            |
| `applications`      | Lamaran kerja         | Jumlah pelamar, hired rate      |
| `training_programs` | Pelatihan             | Jumlah program aktif            |
| `enrollments`       | Pendaftaran pelatihan | Jumlah peserta, completion rate |
| `certificates`      | Sertifikat            | Jumlah sertifikat terbit        |

### **ðŸ”¹ View / Materialized View yang Dibutuhkan**

#### **`v_kpi_jobs`**

- `select`
- `count(*) filter (where status = 'published') as active_jobs,`
- `count(*) filter (where status = 'closed') as closed_jobs,`
- `date_trunc('month', created_at) as period`
- `from jobs`
- `group by period;`

  #### **`v_kpi_applications`**

- `select`
- `date_trunc('month', created_at) as period,`
- `count(*) as total_applications,`
- `count(*) filter (where status = 'hired') as hired,`
- `round(`
-     `count(*) filter (where status = 'hired')::numeric / nullif(count(*),0) * 100, 1`
- `) as hiring_rate`
- `from applications`
- `group by period;`

  #### **`v_kpi_trainings`**

- `select`
- `count(distinct tp.id) filter (where tp.status='published') as active_programs,`
- `count(distinct e.user_id) as participants,`
- `count(*) filter (where e.status='completed') as completed,`
- `round(`
-     `count(*) filter (where e.status='completed')::numeric /`
-     `nullif(count(*) filter (where e.status in ('confirmed','in_progress','completed')),0) * 100, 1`
- `) as completion_rate`
- `from training_programs tp`
- `join training_classes tc on tc.program_id = tp.id`
- `join enrollments e on e.class_id = tc.id`
- `group by tp.provider_id;`

  #### **`v_kpi_certificates`**

- `select`
- `date_trunc('month', issued_at) as period,`
- `count(*) as total_certificates`
- `from certificates`
- `group by period;`

  ***

  ## **5\) RLS (Row Level Security) â€“ Garis Besar**

| Role                      | Akses Data KPI                                                              |
| ------------------------- | --------------------------------------------------------------------------- |
| **Admin**                 | Semua lembaga & perusahaan                                                  |
| **Institution (LPK/BLK)** | Data `training_programs` dan `enrollments` milik `provider_id = auth.uid()` |
| **Employer**              | Data `jobs` dan `applications` milik `created_by = auth.uid()`              |

**Implementasi di Supabase View:**  
 Gunakan fungsi `auth.uid()` untuk memfilter data sesuai role aktif pengguna, contoh:

- `create or replace view v_kpi_institution as`
- `select * from v_kpi_trainings where provider_id = auth.uid();`

  ***

  ## **6\) Validasi & Aturan Bisnis**

- **Data Real-Time**:

  - Gunakan data langsung dari tabel untuk angka hari ini.

- **Data Historis / Agregat**:

  - Gunakan materialized view yang diperbarui otomatis setiap hari (melalui cron job Supabase).

- **Rasio dan persentase** harus dibulatkan ke 1 desimal.

- **Grafik tren** (mingguan/bulanan) tidak boleh kosong meski tidak ada data (zero-fill).

  ***

  ## **7\) Server Actions / API (Contoh)**

- `// Get KPI summary`
- `getKpiSummary({ startDate, endDate, orgId? })`
-
- `// Get recruitment funnel`
- `getRecruitmentFunnel({ startDate, endDate, orgId? })`
-
- `// Get training funnel`
- `getTrainingFunnel({ startDate, endDate, providerId? })`
-
- `// Get top employers / top programs`
- `getTopEmployers()`
- `getTopPrograms()`
-
- `// Export CSV`
- `exportKpiReport({ type, startDate, endDate, orgId? })`

  ***

  ## **8\) UI/UX â€“ Komponen Inti**

  ### **ðŸ”¹ Komponen**

- `KpiStatCard`: angka besar \+ delta (%)

- `FunnelChart`: visualisasi progres (Rekrutmen/Pelatihan)

- `TimeSeriesChart`: tren pelamar & peserta (mingguan/bulanan)

- `CompletionRateBar`: tingkat kelulusan per lembaga

- `TopListTable`: daftar lembaga/perusahaan terbaik

- `FilterBar`: date range \+ dropdown lembaga/lokasi

  ### **ðŸ”¹ UX & Interaksi**

- Filter global mempengaruhi seluruh komponen.

- Klik kartu KPI â†’ membuka grafik atau tabel rinci.

- Export PDF/CSV di setiap bagian.

- Skeleton loading & animasi (pakai Framer Motion).

  ***

  ## **9\) Notifikasi & Integrasi**

- **Email / PDF laporan bulanan otomatis** ke admin lembaga (opsional).

- **Webhook / API Integrasi** ke dashboard eksternal (mis. Dinas Tenaga Kerja Provinsi).

  ***

  ## **10\) Acceptance Criteria (Checklist)**

- Admin dapat melihat KPI global lintas lembaga & perusahaan.

- LPK/BLK hanya melihat KPI pelatihannya sendiri.

- Employer hanya melihat KPI rekrutmennya sendiri.

- Semua angka KPI akurat sesuai definisi.

- Grafik funnel & time series menampilkan tren sesuai periode.

- Export laporan bekerja dan hasil valid.

- RLS memastikan data tiap lembaga/instansi aman.

- Dashboard responsif dan ringan diakses.

# User Management

# **ðŸ§­ 1\) Alur Pengguna (End-to-End)**

**A. Candidate (Lulusan/Mahasiswa)**

1. Landing â†’ Join â†’ pilih **Candidate** â†’ Register/Login

2. Onboarding profil kandidat â†’ **langsung aktif** (tanpa approval)

3. Akses fitur: apply lowongan, daftar pelatihan, kelola profil & CV

**B. Institution (LPK/BLK)**

1. Landing â†’ Join â†’ pilih **Institution** â†’ Register/Login

2. Onboarding profil lembaga â†’ status awal: **pending_approval**

3. Admin review â†’ **approved** â†’ akses Dashboard Institution (manage trainings, kelas, peserta)

4. Jika **rejected**, user menerima alasan; dapat **resubmit** data

**C. Employer (Perusahaan)**

1. Landing â†’ Join â†’ pilih **Employer** â†’ Register/Login

2. Onboarding profil perusahaan â†’ **pending_approval**

3. Admin review â†’ **approved** â†’ akses Dashboard Employer (post job, review pelamar)

4. Jika **rejected**, user menerima alasan; dapat **resubmit**

**D. Admin (Departemen/P2TK)**

1. Login â†’ Dashboard Admin

2. Menu **Approvals**: antrean Institution/Employer/Entitas (job/program)

3. Approve/Reject (dengan catatan), atau minta perbaikan data

4. Atur role (promote/demote), **suspend** akun, **view-as** (opsional)

---

# **ðŸ§± 2\) Struktur Halaman (Next.js App Router)**

- `/dashboard/admin/approvals` â€“ antrean approval global

- `/dashboard/admin/approvals/[id]` â€“ detail permohonan \+ dokumen \+ aksi

- `/dashboard/admin/roles` â€“ manajemen role & akses (opsional)

- `/pending-approval` â€“ halaman penjelasan untuk user yang menunggu verifikasi

- `/settings/access-policy` â€“ (opsional) matriks akses & toggle kebijakan

---

# **âš™ï¸ 3\) Fitur & Aturan per Peran**

### **A. Admin**

- **Approval Queue**:

  - **Akun**: Institution, Employer

  - **Konten sensitif (opsional)**: Job dari employer baru, Program pelatihan dari institution baru

- **Aksi**: Approve, Reject (dengan alasan), Request Changes (kembalikan ke draft)

- **Role Management**: set/unset `admin`, **suspend** user, **lock** organisasi

- **View-as (opsional)**: melihat tampilan sebagai role tertentu (read-only)

- **Audit & Log**: semua keputusan terekam (siapa, kapan, alasan)

### **B. Institution**

- Submit/Update profil lembaga hingga lengkap â†’ kirim untuk verifikasi

- Melihat status permohonan \+ history catatan

- Setelah approved: CRUD programs/kelas; konten baru bisa auto-publish atau **pending** tergantung kebijakan

### **C. Employer**

- Submit/Update profil perusahaan â†’ kirim untuk verifikasi

- Setelah approved: CRUD lowongan (auto-publish atau **pending** tergantung kebijakan)

### **D. Candidate**

- Tidak perlu approval (langsung aktif)

- Dibatasi pada aksi kandidat (apply/enroll/kelola profil)

---

# **ðŸ—ƒï¸ 4\) Model Data (Supabase â€“ Ringkas)**

### **4.1 Role & Profil**

**`profiles`**

- `id` (uuid, pk \= auth.uid)

- `role` (`candidate` | `institution` | `employer` | `admin`) // peran aktif saat ini

- `onboarding_completed` (bool)

- `suspended` (bool default false)

**`user_roles`** _(opsional untuk multi-role)_

- `user_id` (uuid)

- `role` (text)

- `status` (`pending_approval` | `approved` | `rejected`)

- unique (`user_id`, `role`)

Jika tidak butuh multi-role, cukup pakai `profiles.role` \+ tabel entitas `institutions`/`employers` bertanda status.

### **4.2 Entitas yang Di-approve**

**`institutions`**

- `id` (uuid, pk)

- `user_id` (owner)

- `name`, `type` (`blk_pemerintah`/`blk_pesantren`/`lpk`), `address`, `city`, `province`, `email`, `phone`

- `capacity_month`, `facilities[]`, `specialties[]`

- `status` (`pending_approval` | `approved` | `rejected` | `suspended`)

- `review_notes` (text)

**`employers`**

- `id` (uuid, pk)

- `user_id` (owner)

- `company_name`, `industry`, `address`, `city`, `province`, `website`, `pic_*`

- `status` (sama seperti institutions)

- `review_notes` (text)

### **4.3 Log Persetujuan**

**`approvals`**

- `id` (uuid, pk)

- `entity_type` (`institution` | `employer` | `job` | `training_program`)

- `entity_id` (uuid)

- `action` (`submitted` | `approved` | `rejected` | `request_changes`)

- `reason` (text, nullable)

- `acted_by` (uuid â†’ admin)

- `created_at` (timestamptz)

**`activity_logs`** _(opsional lebih generik)_

- `id`, `actor_id`, `action`, `target_type`, `target_id`, `meta`, `created_at`

---

# **ðŸ” 5\) RLS (Row Level Security) â€“ Garis Besar**

**`profiles`**

- `select/update`: owner (auth.uid \= id)

- admin: full

**`institutions` / `employers`**

- `select`:

  - publik: field aman (profil ringkas) jika `status = 'approved'`

  - owner \+ admin: full

- `insert`: owner only (user role must be institution/employer intent)

- `update`:

  - owner: hanya jika `status != 'approved'` **atau** area edit terbatas (alamat/contacts)

  - admin: full

- `delete`: admin only (umumnya soft-delete via `status='suspended'`)

**`approvals`**

- `select`: admin only

- `insert`: sistem/admin ketika ada aksi

- `update/delete`: admin only

Kebijakan tambahan: **gate** akses menu sesuai `profiles.role`, dan **redirect** user berstatus `pending_approval` ke `/pending-approval`.

---

# **ðŸ§ª 6\) Validasi & Aturan Bisnis**

- **Institution/Employer**:

  - Wajib isi field minimal (nama, alamat, kota, PIC) sebelum submit

  - Saat submit: set `status='pending_approval'` \+ entry di `approvals (submitted)`

- **Admin Approve**:

  - Cek kelengkapan dokumen

  - Set `status='approved'` \+ catat `approvals (approved)`

  - Kirim notifikasi ke owner

- **Admin Reject**:

  - Wajib isi **reason**

  - Set `status='rejected'` \+ `approvals (rejected)`

  - Owner dapat **resubmit** setelah revisi

- **Suspend**:

  - Admin bisa **suspend** institution/employer jika ada pelanggaran (hide dari publik, blok CRUD)

- **Kebijakan Postingan** (opsional by setting):

  - Employer baru: job pertama **pending** hingga diverifikasi

  - Institution baru: program pertama **pending** hingga diverifikasi

---

# **ðŸ”Œ 7\) Server Actions / API (Contoh)**

`// USER ROLE & INTENT`  
`setIntendedRole({ role })                   // setelah /join`  
`switchActiveRole({ role })                  // jika multi-role`

`// INSTITUTION / EMPLOYER SUBMISSION`  
`submitInstitutionProfile(payload)           // set status=pending_approval + approvals(submitted)`  
`submitEmployerProfile(payload)`

`// ADMIN APPROVALS`  
`listApprovals({ entityType?, status?, q? })`  
`getApprovalDetail({ entityType, entityId })`

`approveEntity({ entityType, entityId, note? })    // status=approved + approvals(approved)`  
`rejectEntity({ entityType, entityId, reason })    // status=rejected + approvals(rejected)`  
`requestChanges({ entityType, entityId, note })    // status=pending_approval + approvals(request_changes)`

`// ADMIN ROLES`  
`promoteToAdmin({ userId })`  
`demoteFromAdmin({ userId })`  
`suspendAccount({ entityType, entityId, reason })`

Gunakan **Zod** untuk validasi payload, simpan semua aksi ke `approvals`/`activity_logs`, dan **emit notifikasi** (email/WA) sesuai event.

---

# **ðŸ§© 8\) UI/UX â€“ Komponen Inti**

- **ApprovalsTable** (Admin):  
   kolom: Tanggal, Entitas, Nama, Status, Aktor, Aksi (Approve/Reject/Request Changes)

- **ApprovalDetailDrawer**:  
   menampilkan data lengkap \+ dokumen pendukung \+ form alasan

- **RoleBadge**: menandai role aktif (Admin/Institution/Employer/Candidate)

- **PendingApprovalPage**:  
   status & instruksi apa yang harus dilengkapi; tombol **Resubmit**

- **AccessGuard** (HOC/middleware):  
   redirect user sesuai role & status

- **AuditTrail** (opsional):  
   timeline aksi persetujuan

**UX Notes**

- Beri **konfirmasi modal** saat Approve/Reject (wajib isi alasan saat reject).

- **Toast** sukses/gagal; tampilkan **highlight** field yang belum lengkap saat Request Changes.

- Aksi **bulk approve** bisa ditambahkan jika volume tinggi (opsional).

---

# **âœ‰ï¸ 9\) Notifikasi**

**Trigger**

- Submit profil (Institution/Employer) â†’ notifikasi ke Admin (email)

- Approved/Rejected/Request Changes â†’ notifikasi ke pemilik akun \+ catatan

**Channel**

- Email (Resend/SendGrid).

- WhatsApp (opsional) untuk mempercepat follow-up.

**Template (contoh subject)**

- `[P2TK] Pengajuan Lembaga Disetujui`

- `[P2TK] Pengajuan Lembaga Dikembalikan â€“ Mohon Revisi`

- `[P2TK] Pengajuan Perusahaan Ditolak â€“ Alasan Terlampir`

---

# **âœ… 10\) Acceptance Criteria (Checklist)**

- Institution/Employer yang submit profil berubah ke `pending_approval` dan muncul di antrean admin

- Admin dapat **approve/reject/request changes** dengan catatan/ alasan

- Status & catatan terlihat oleh pemilik; user **rejected** bisa **resubmit**

- Role guard memastikan hanya **approved** yang bisa CRUD (jobs/trainings)

- Candidate tidak memerlukan approval dan aksesnya terbatas

- Semua aksi persetujuan tercatat di `approvals` \+ timestamp \+ acted_by

- Notifikasi terkirim pada setiap perubahan status

- RLS & guard mencegah akses lintas entitas yang tidak berhak

- (Opsional) Admin bisa **suspend** akun organisasi & blokir akses

---

## **(Opsional) DDL Singkat**

`create type entity_type as enum ('institution','employer','job','training_program');`  
`create type approval_action as enum ('submitted','approved','rejected','request_changes');`

`create table approvals (`  
 `id uuid primary key default gen_random_uuid(),`  
 `entity_type entity_type not null,`  
 `entity_id uuid not null,`  
 `action approval_action not null,`  
 `reason text,`  
 `acted_by uuid references auth.users(id),`  
 `created_at timestamptz default now()`  
`);`

`alter table institutions`  
 `add column status text not null default 'pending_approval',`  
 `add column review_notes text;`

`alter table employers`  
 `add column status text not null default 'pending_approval',`  
 `add column review_notes text;`

RLS: `approvals` read/write admin; `institutions`/`employers` update limited by owner; select publik hanya untuk `status='approved'` (field aman).

# Notification

# **ðŸ§­ 1\) Alur Pengguna (End-to-End)**

**A. Sistem â†’ User (Transactional)**

1. Event terjadi (mis. apply loker, status approve, kelas dimulai H-1).

2. Sistem **enqueue** notifikasi sesuai template & preferensi kanal user.

3. Worker/Edge Function memproses antrian â†’ kirim **Email / WhatsApp / In-App**.

4. Terekam **delivery log** (sukses/gagal) \+ retry (exponential backoff).

5. User membuka **Inbox in-app** (ikon bel) â†’ tandai terbaca.

**B. Admin/Operator**

1. Mengubah **template** (copywriting, variabel) & preferensi default kanal.

2. Melihat **log pengiriman** & rate error.

3. Menjadwalkan **digest** (rekap mingguan/bulanan) ke stakeholder.

---

# **ðŸ—ºï¸ 2\) Struktur Halaman (Next.js App Router)**

- `/dashboard/admin/notifications` â€“ monitor outbox & delivery log.

- `/dashboard/admin/notifications/templates` â€“ **CRUD** template (email/WA/in-app).

- `/dashboard/settings/notifications` â€“ pengaturan preferensi kanal per user (opt-in/out, quiet hours).

- `/inbox` â€“ **in-app notification center** (user).

---

# **âš™ï¸ 3\) Fitur & Aturan per Peran**

### **A. Admin**

- Kelola **template** (multi-channel): judul, body, variabel, pratinjau.

- Pengaturan **default policy**: kanal prioritas (Email â†’ WA â†’ In-app), retry limit, quiet hours.

- Lihat **outbox** (antrian), **delivery log**, filter per tipe notifikasi & status.

- Jadwalkan **digest** (rekap KPI) via cron.

### **B. Institution / Employer**

- Melihat notifikasi yang relevan (approval, lamaran masuk, pendaftar kelas).

- Atur preferensi kanal pribadi (mis. hanya email).

### **C. Candidate**

- Menerima notifikasi: verifikasi akun, status lamaran, status enrolment, jadwal kelas, sertifikat.

- Atur preferensi (opt-out WA, tetap in-app & email).

---

# **ðŸ—ƒï¸ 4\) Model Data (Supabase â€“ Ringkas)**

**`notification_templates`**

- `id` (uuid, pk)

- `key` (text unique) â€” ex: `auth.welcome`, `job.applied`, `job.status.update`, `training.reminder`, `approval.result`, `certificate.issued`, `digest.weekly`

- `channel` (enum: `email` | `whatsapp` | `inapp`)

- `title` (text) // email subject / in-app title

- `body` (text) // support placeholder `{{name}}`, `{{job_title}}`

- `enabled` (bool)

- `locale` (text, default `id-ID`)

- `created_at`, `updated_at`

**`user_channel_prefs`**

- `user_id` (uuid, pk)

- `email_enabled` (bool default true)

- `wa_enabled` (bool default false)

- `inapp_enabled` (bool default true)

- `quiet_hours` (jsonb) // ex: `{ "start":"22:00", "end":"06:00", "tz":"Asia/Jakarta" }`

**`notification_outbox`** (queue/antrian)

- `id` (uuid, pk)

- `user_id` (uuid)

- `template_key` (text)

- `channel` (enum)

- `payload` (jsonb) // data untuk render template

- `scheduled_at` (timestamptz, nullable)

- `status` (enum: `queued` | `processing` | `sent` | `failed` | `canceled`)

- `attempts` (int default 0\)

- `error_message` (text, nullable)

- `created_at`, `updated_at`

**`notification_logs`** (immutable)

- `id` (uuid, pk)

- `outbox_id` (uuid fk)

- `provider_message_id` (text, nullable)

- `channel` (enum)

- `status_code` (int, nullable)

- `delivered_at` (timestamptz, nullable)

- `provider_meta` (jsonb)

**`inapp_notifications`**

- `id` (uuid, pk)

- `user_id` (uuid)

- `title` (text)

- `body` (text)

- `link_url` (text, nullable)

- `read_at` (timestamptz, nullable)

- `created_at`

Catatan: untuk **Email** gunakan Resend/SendGrid; **WhatsApp** Fonnte/Twilio; **In-App** disimpan lokal.

---

# **ðŸ” 5\) RLS (Row Level Security) â€“ Garis Besar**

- **`notification_templates`**: select admin; write admin only.

- **`user_channel_prefs`**: user hanya baca/tulis miliknya; admin read.

- **`notification_outbox`**:

  - select admin; user tidak perlu.

  - insert oleh server actions/fungsi (service role).

- **`notification_logs`**: select admin.

- **`inapp_notifications`**: user hanya dapat select/update notifikasi miliknya.

---

# **ðŸ§ª 6\) Validasi & Aturan Bisnis**

- **Idempotensi**: setiap event punya `event_id`; sebelum enqueue, cek outbox duplikat (idempotency key: `user_id + template_key + event_id`).

- **Retry Policy**: `attempts < 3` dengan **exponential backoff** (2m, 10m, 30m).

- **Quiet Hours**: jika `now` dalam rentang **quiet hours**, jadwalkan ke `scheduled_at` (di luar jam tenang) â€” kecuali notifikasi kritikal (verifikasi akun, reset password, perubahan status penting).

- **Fallback Channel**: jika kanal utama gagal dan user mengizinkan, fallback ke kanal lain (misal: email â†’ in-app).

- **Localisasi**: pilih template berdasarkan `locale` user, default `id-ID`.

- **Sanitasi**: render body dengan sanitasi variabel (hindari injection).

- **Rate limit**: batasi kirim per user (mis. max 10/hari untuk non-transaksional).

---

# **ðŸ”Œ 7\) Server Actions / API (Contoh)**

**Enqueue notifikasi (umum)**

`// server action`  
`async function enqueueNotification({`  
 `userId,`  
 `templateKey,`  
 `preferredChannel, // 'email' | 'whatsapp' | 'inapp'`  
 `payload,          // { name, job_title, ... }`  
 `eventId,          // for idempotency`  
 `scheduleAt        // optional`  
`}) {`  
 `// 1) Fetch user prefs`  
 `const prefs = await getUserPrefs(userId)`  
 `const channel = resolveChannel(preferredChannel, prefs) // fallback logic`

`// 2) Idempotency check`  
 `const exists = await db.outbox.findFirst({`  
 `where: { user_id: userId, template_key: templateKey, payload_event_id: eventId }`  
 `})`  
 `if (exists) return exists.id`

`// 3) Quiet hours -> schedule`  
 `const sched = shouldDelayByQuietHours(prefs) ? nextAllowedTime(prefs) : scheduleAt`

`// 4) Insert outbox`  
 `return await db.outbox.insert({`  
 `user_id: userId,`  
 `template_key: templateKey,`  
 `channel,`  
 `payload,`  
 `scheduled_at: sched,`  
 `status: 'queued'`  
 `})`  
`}`

**Worker/Edge Function (cron tiap 1â€“5 menit)**

`// pseudo-code`  
`const jobs = await db.outbox.list({ status:'queued', scheduled_at <= now() }).limit(100)`

`for (const job of jobs) {`  
 `await db.outbox.update(job.id, { status: 'processing', attempts: job.attempts+1 })`

`try {`  
 `const tpl = await db.templates.get(job.template_key, job.channel, localeFrom(job.user_id))`  
 `const rendered = renderTemplate(tpl, job.payload)`

    `const result = await sendViaProvider(job.channel, job.user_id, rendered)`

    `await db.logs.insert({ outbox_id: job.id, provider_message_id: result.id, channel: job.channel, delivered_at: now(), provider_meta: result.meta })`
    `await db.outbox.update(job.id, { status: 'sent' })`

    `if (job.channel === 'inapp') {`
      `await db.inapp.create({ user_id: job.user_id, title: tpl.title, body: rendered.body, link_url: rendered.link })`
    `}`

`} catch (e) {`  
 `const failed = job.attempts >= 3`  
 `await db.outbox.update(job.id, { status: failed ? 'failed' : 'queued', error_message: e.message, scheduled_at: failed ? null : nextBackoff(job.attempts) })`  
 `}`  
`}`

---

# **ðŸ§© 8\) UI/UX â€“ Komponen Inti**

- **InAppBell** (ikon bel \+ badge): klik â†’ panel `/inbox` (list, tandai baca).

- **NotificationItem**: title, snippet body, waktu relatif, **link CTA** (detail job/enrolment).

- **Adminâ€“TemplateEditor**: editor teks dengan placeholder & preview multi-channel.

- **Adminâ€“OutboxTable**: status antrian (queued/processing/sent/failed), retry, cancel.

- **Adminâ€“LogsTable**: filter by channel, waktu, kata kunci subject/body.

- **Userâ€“PrefsForm**: toggle kanal, set **quiet hours**, pilih bahasa (ID/EN).

**UX Notes**

- Gunakan **toast** untuk feedback instan (apply sukses, enroll sukses).

- Simpan **polisi UI**: notifikasi kritikal boleh menimpa quiet hours.

---

# **âœ‰ï¸ 9\) Template & Integrasi (Contoh)**

**Tipe Notifikasi & `template_key`**

- `auth.welcome` â€“ Selamat datang & verifikasi akun.

- `approval.result` â€“ Hasil permohonan (Institution/Employer).

- `job.applied` â€“ Lamaran berhasil dikirim.

- `job.status.update` â€“ Status lamaran berubah.

- `training.enrolled` â€“ Pendaftaran kelas berhasil.

- `training.reminder` â€“ Pengingat H-1 jadwal kelas.

- `certificate.issued` â€“ Sertifikat siap diunduh.

- `digest.weekly` â€“ Rekap KPI mingguan.

**Contoh Template Email (`job.status.update`)**

- **Subject**: `Status Lamaran "{{job_title}}" Diperbarui`

**Body**:

`Halo {{name}},`  
`Status lamaran Anda untuk posisi {{job_title}} telah berubah menjadi {{status_label}}.`  
`Lihat detail: {{application_link}}`

`Terima kasih,`  
`Tim P2TK PKS Jawa Barat`

-

**Provider**

- **Email**: Resend/SendGrid (API key di env, template html sederhana).

- **WhatsApp**: Fonnte/Twilio (template disetujui; hindari spam; simpan `provider_message_id`).

- **In-App**: render di UI dari `inapp_notifications`.

**Digest Cron**

- **Weekly**: tiap Senin 08:00 WIB â†’ kirim ke Admin/LPK ringkasan `jobs/applications/enrollments/certificates` minggu lalu.

---

# **âœ… 10\) Acceptance Criteria (Checklist)**

- Event memicu **enqueue** notifikasi sesuai template & preferensi kanal user.

- Outbox memproses antrian & mencatat **delivery log** (sukses/gagal).

- **Retry** otomatis max 3x dengan backoff; fallback kanal jika diizinkan.

- **Quiet hours** dihormati (kecuali notifikasi kritikal).

- User dapat mengelola **preferensi kanal** & melihat **in-app inbox**.

- Admin dapat mengelola template & memonitor outbox/logs.

- Semua payload disanitasi; tidak ada PII bocor ke pihak luar selain yang relevan.

- Cron digest berjalan & terkirim sesuai jadwal.

- RLS: user hanya bisa melihat notifikasi miliknya; admin bisa lihat semua log.
